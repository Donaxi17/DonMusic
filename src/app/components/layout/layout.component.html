<div class="min-h-screen bg-zinc-950 text-white flex flex-col">

    <!-- HEADER DESKTOP (Sticky) -->
    <header class="border-b border-zinc-800 bg-black/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">

            <!-- Logo -->
            <h1 class="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-green-500 bg-clip-text text-transparent cursor-pointer hover:opacity-80 transition-opacity"
                (click)="navigateTo('/')">
                DonMusica
            </h1>

            <!-- Desktop Nav -->
            <nav class="hidden md:flex items-center gap-1">
                <button (click)="navigateTo('/')" [class.text-emerald-400]="isActive('/')"
                    [class.text-zinc-400]="!isActive('/')"
                    class="px-4 py-2 rounded-full hover:bg-white/5 transition-colors text-sm font-medium hover:text-white">
                    Inicio
                </button>
                <button (click)="navigateTo('/artists')" [class.text-emerald-400]="isActive('/artists')"
                    [class.text-zinc-400]="!isActive('/artists')"
                    class="px-4 py-2 rounded-full hover:bg-white/5 transition-colors text-sm font-medium hover:text-white">
                    Artistas
                </button>
                <button (click)="navigateTo('/browse')" [class.text-emerald-400]="isActive('/browse')"
                    [class.text-zinc-400]="!isActive('/browse')"
                    class="px-4 py-2 rounded-full hover:bg-white/5 transition-colors text-sm font-medium hover:text-white flex items-center gap-2">
                    <i class='bx bx-compass text-lg'></i> Explorar
                </button>
                <button (click)="navigateTo('/videos')" [class.text-red-400]="isActive('/videos')"
                    [class.text-zinc-400]="!isActive('/videos')"
                    class="px-4 py-2 rounded-full hover:bg-white/5 transition-colors text-sm font-medium hover:text-white flex items-center gap-2">
                    <i class='bx bxl-youtube text-lg'></i> Videos
                </button>

                <!-- History Button (Desktop) -->
                <button (click)="toggleHistory()" [class.text-emerald-400]="showHistory"
                    class="ml-2 w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10 text-zinc-400 hover:text-white transition-colors"
                    title="Historial de reproducción">
                    <i class='bx bx-history text-xl'></i>
                </button>

                <!-- More Menu Desktop -->
                <div class="relative ml-2">
                    <button (click)="toggleMoreMenu()"
                        class="w-9 h-9 flex items-center justify-center rounded-full hover:bg-white/10 text-zinc-400 hover:text-white transition-colors">
                        <i class='bx' [class.bx-dots-vertical-rounded]="!showMoreMenu" [class.bx-x]="showMoreMenu"></i>
                    </button>

                    <div *ngIf="showMoreMenu"
                        class="absolute top-full right-0 mt-2 w-60 bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl overflow-hidden py-1 z-50 animate-fade-in origin-top-right">
                        <button (click)="navigateTo('/sin-copyright'); closeMoreMenu()"
                            class="w-full text-left px-4 py-3 hover:bg-zinc-800 flex items-center gap-3 text-sm text-zinc-300 hover:text-white group">
                            <div
                                class="w-8 h-8 rounded-full bg-emerald-500/10 flex items-center justify-center group-hover:bg-emerald-500/20 text-emerald-500">
                                <i class='bx bx-shield-alt-2'></i>
                            </div>
                            Sin Copyright
                        </button>
                        <div class="h-px bg-zinc-800 mx-4"></div>
                        <button (click)="navigateTo('/converter'); closeMoreMenu()"
                            class="w-full text-left px-4 py-3 hover:bg-zinc-800 flex items-center gap-3 text-sm text-zinc-300 hover:text-white">
                            <i class='bx bx-cloud-download text-lg w-6 text-center text-red-400'></i> Convertidor
                        </button>
                        <button (click)="navigateTo('/playlists'); closeMoreMenu()"
                            class="w-full text-left px-4 py-3 hover:bg-zinc-800 flex items-center gap-3 text-sm text-zinc-300 hover:text-white">
                            <i class='bx bx-list-ul text-lg w-6 text-center text-yellow-400'></i> Playlists
                        </button>
                        <button (click)="navigateTo('/radio'); closeMoreMenu()"
                            class="w-full text-left px-4 py-3 hover:bg-zinc-800 flex items-center gap-3 text-sm text-zinc-300 hover:text-white">
                            <i class='bx bx-radio text-lg w-6 text-center text-blue-400'></i> Radio
                        </button>
                        <button (click)="navigateTo('/blog'); closeMoreMenu()"
                            class="w-full text-left px-4 py-3 hover:bg-zinc-800 flex items-center gap-3 text-sm text-zinc-300 hover:text-white">
                            <i class='bx bx-news text-lg w-6 text-center text-purple-400'></i> Blog
                        </button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- MAIN CONTENT (Dynamic Padding) -->
    <main class="flex-1 transition-all duration-300 relative z-0" [class.pb-28]="currentSong"
        [class.pb-safe-bottom]="!currentSong" [class.md:pb-0]="true">
        <router-outlet></router-outlet>
        <!-- Redes Sociales (Ocultas si el historial está abierto) -->
        <app-redes-sociales *ngIf="!showHistory"></app-redes-sociales>
    </main>

    <!-- FOOTER -->
    <app-footer></app-footer>

    <!-- ========================================== -->
    <!-- MOBILE BOTTOM NAVIGATION (Fixed) -->
    <!-- ========================================== -->
    <nav
        class="md:hidden fixed bottom-0 left-0 right-0 bg-black/90 backdrop-blur-xl border-t border-white/5 z-50 px-2 pb-safe pt-2 h-[calc(3.5rem+env(safe-area-inset-bottom,20px))] flex justify-around items-start">
        <button (click)="navigateTo('/')"
            class="flex flex-col items-center justify-center w-14 gap-0.5 transition-colors duration-300"
            [class.text-emerald-400]="isActive('/')" [class.text-zinc-500]="!isActive('/')">
            <i class='bx text-2xl mb-px' [class.bxs-home]="isActive('/')" [class.bx-home]="!isActive('/')"></i>
            <span class="text-[9px] font-medium tracking-wide">Inicio</span>
        </button>

        <button (click)="navigateTo('/artists')"
            class="flex flex-col items-center justify-center w-14 gap-0.5 transition-colors duration-300"
            [class.text-emerald-400]="isActive('/artists')" [class.text-zinc-500]="!isActive('/artists')">
            <i class='bx text-2xl mb-px' [class.bxs-music]="isActive('/artists')"
                [class.bx-music]="!isActive('/artists')"></i>
            <span class="text-[9px] font-medium tracking-wide">Artistas</span>
        </button>

        <button (click)="navigateTo('/browse')"
            class="flex flex-col items-center justify-center w-14 gap-0.5 transition-colors duration-300"
            [class.text-emerald-400]="isActive('/browse')" [class.text-zinc-500]="!isActive('/browse')">
            <i class='bx text-2xl mb-px' [class.bxs-compass]="isActive('/browse')"
                [class.bx-compass]="!isActive('/browse')"></i>
            <span class="text-[9px] font-medium tracking-wide">Explorar</span>
        </button>

        <button (click)="navigateTo('/videos')"
            class="flex flex-col items-center justify-center w-14 gap-0.5 transition-colors duration-300"
            [class.text-red-500]="isActive('/videos')" [class.text-zinc-500]="!isActive('/videos')">
            <i class='bx text-2xl mb-px' [class.bxs-videos]="isActive('/videos')"
                [class.bx-video]="!isActive('/videos')"></i>
            <span class="text-[9px] font-medium tracking-wide">Videos</span>
        </button>

        <button (click)="toggleMobileMoreMenu()"
            class="flex flex-col items-center justify-center w-14 gap-0.5 transition-colors duration-300"
            [class.text-emerald-400]="showMobileMoreMenu || isMoreActive()"
            [class.text-zinc-500]="!showMobileMoreMenu && !isMoreActive()">
            <i class='bx bx-grid-alt text-2xl mb-px'></i>
            <span class="text-[9px] font-medium tracking-wide">Más</span>
        </button>
    </nav>


    <!-- ========================================== -->
    <!-- MINI PLAYER -->
    <!-- ========================================== -->
    <div *ngIf="!isActive('/player') && currentSong" class="fixed left-2 right-2 md:left-auto md:right-8 md:bottom-8 md:w-96 
               bottom-[calc(3.8rem+env(safe-area-inset-bottom,20px))] 
               bg-zinc-900/95 backdrop-blur-xl border border-white/10 rounded-xl p-2 z-40 
               flex items-center gap-3 shadow-2xl shadow-black/50 animate-slide-up cursor-pointer"
        (click)="openPlayer()">

        <div class="relative w-12 h-12 rounded-lg overflow-hidden bg-zinc-800 flex-shrink-0 shadow-lg">
            <img [src]="currentSong.img" class="w-full h-full object-cover">
            <div *ngIf="isPlaying && !isFavoritesPlaying"
                class="absolute inset-0 bg-black/30 flex items-center justify-center">
                <div class="flex gap-0.5 items-end h-3">
                    <div class="w-0.5 bg-emerald-400 animate-music-bar"></div>
                    <div class="w-0.5 bg-emerald-400 animate-music-bar animation-delay-75"></div>
                    <div class="w-0.5 bg-emerald-400 animate-music-bar animation-delay-150"></div>
                </div>
            </div>
        </div>

        <div class="flex-1 min-w-0 flex flex-col justify-center">
            <p class="text-xs md:text-sm font-bold truncate text-white leading-tight mb-0.5">
                {{currentSong.title}}
            </p>
            <p class="text-[10px] md:text-xs text-zinc-400 truncate flex items-center gap-1">
                {{currentSong.artist}}
                <span *ngIf="isFavoritesPlaying" class="w-1.5 h-1.5 rounded-full bg-red-500 inline-block ml-1"></span>
            </p>
        </div>

        <div class="flex items-center gap-1 md:gap-2 mr-1" (click)="$event.stopPropagation()">
            <button (click)="previousTrack()"
                class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-zinc-400 hover:text-white transition-colors">
                <i class='bx bx-skip-previous text-2xl'></i>
            </button>
            <button (click)="togglePlayPause()"
                class="w-10 h-10 flex items-center justify-center rounded-full bg-white text-black hover:scale-105 active:scale-95 transition-all shadow-lg">
                <i class='bx text-2xl ml-0.5' [class]="isPlaying ? 'bx-pause' : 'bx-play'"></i>
            </button>
            <button (click)="nextTrack()"
                class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-zinc-400 hover:text-white transition-colors">
                <i class='bx bx-skip-next text-2xl'></i>
            </button>
            <button (click)="closePlayer()"
                class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-zinc-500 hover:text-red-400 transition-colors ml-1">
                <i class='bx bx-x text-xl'></i>
            </button>
        </div>
    </div>

    <!-- MOBILE MORE MENU -->
    <div *ngIf="showMobileMoreMenu"
        class="md:hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex flex-col justify-end animate-fade-in"
        (click)="closeMobileMoreMenu()">
        <!-- ... (Contenido del menú móvil sin cambios) ... -->
        <div class="bg-zinc-900 rounded-t-3xl border-t border-zinc-700/50 shadow-2xl overflow-hidden max-h-[80vh] overflow-y-auto"
            (click)="$event.stopPropagation()">
            <div class="flex justify-center pt-3 pb-2 sticky top-0 bg-zinc-900 z-10">
                <div class="w-12 h-1.5 bg-zinc-700/50 rounded-full"></div>
            </div>

            <div class="px-5 pb-8 space-y-2">
                <div class="flex items-center justify-between mb-4 ml-1">
                    <h3 class="text-zinc-400 text-xs font-bold uppercase tracking-wider">Menú Principal</h3>
                    <button (click)="toggleHistory(); closeMobileMoreMenu()"
                        class="text-emerald-400 text-xs font-bold border border-emerald-500/20 px-3 py-1 rounded-full bg-emerald-500/10 hover:bg-emerald-500/20">
                        Ver Historial
                    </button>
                </div>

                <button (click)="navigateTo('/sin-copyright'); closeMobileMoreMenu()" class="menu-item-mobile group">
                    <div
                        class="icon-box bg-emerald-500/10 text-emerald-400 group-hover:bg-emerald-500 group-hover:text-black transition-colors">
                        <i class='bx bx-shield-alt-2'></i>
                    </div>
                    <div class="flex-1 font-medium">Sin Copyright</div>
                    <i class='bx bx-chevron-right text-zinc-600'></i>
                </button>

                <button (click)="navigateTo('/converter'); closeMobileMoreMenu()" class="menu-item-mobile group">
                    <div
                        class="icon-box bg-red-500/10 text-red-500 group-hover:bg-red-500 group-hover:text-white transition-colors">
                        <i class='bx bx-cloud-download'></i>
                    </div>
                    <div class="flex-1 font-medium">Descargar MP3</div>
                    <i class='bx bx-chevron-right text-zinc-600'></i>
                </button>

                <div class="grid grid-cols-2 gap-3 mt-4">
                    <button (click)="navigateTo('/radio'); closeMobileMoreMenu()"
                        class="bg-zinc-800 p-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-zinc-700 transition-colors">
                        <i class='bx bx-radio text-3xl text-blue-400'></i>
                        <span class="text-sm font-medium">Radio FM</span>
                    </button>
                    <button (click)="navigateTo('/playlists'); closeMobileMoreMenu()"
                        class="bg-zinc-800 p-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-zinc-700 transition-colors">
                        <i class='bx bx-list-ul text-3xl text-yellow-400'></i>
                        <span class="text-sm font-medium">Playlists</span>
                    </button>
                    <button (click)="navigateTo('/blog'); closeMobileMoreMenu()"
                        class="bg-zinc-800 p-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-zinc-700 transition-colors">
                        <i class='bx bx-news text-3xl text-purple-400'></i>
                        <span class="text-sm font-medium">Blog</span>
                    </button>
                    <button (click)="navigateTo('/saved-lyrics'); closeMobileMoreMenu()"
                        class="bg-zinc-800 p-4 rounded-2xl flex flex-col items-center gap-2 hover:bg-zinc-700 transition-colors">
                        <i class='bx bx-bookmark text-3xl text-orange-400'></i>
                        <span class="text-sm font-medium">Letras</span>
                    </button>
                </div>
            </div>

            <button (click)="closeMobileMoreMenu()"
                class="w-full py-5 text-center text-zinc-400 font-medium border-t border-white/5 hover:bg-white/5 active:bg-white/10 pb-10">Cerrar</button>
        </div>
    </div>

    <!-- HISTORY PANEL (SHARED) -->
    <app-recently-played *ngIf="showHistory"></app-recently-played>

</div>