<div class="discover-container">
    <!-- Header -->
    <div class="discover-header">
        <div class="header-content">
            <h1 class="title">
                <span class="icon">üåç</span>
                Descubre M√∫sica
            </h1>
            <p class="subtitle">Explora m√∫sica libre de todo el mundo con licencia Creative Commons</p>
        </div>

        @if (songs().length > 0) {
        <button class="play-all-btn" (click)="playAll()">
            <span class="icon">‚ñ∂Ô∏è</span>
            Reproducir Todo
        </button>
        }
    </div>

    <!-- Search and Filters -->
    <div class="controls-section">
        <!-- Search Bar -->
        <div class="search-container">
            <input type="text" class="search-input" placeholder="üîç Buscar canciones, artistas..."
                [(ngModel)]="searchQuery" (keyup.enter)="onSearch()" />
            <button class="search-btn" (click)="onSearch()">Buscar</button>
        </div>

        <!-- Genre Filter -->
        <div class="genre-filter">
            @for (genre of genres; track genre.value) {
            <button class="genre-btn" [class.active]="selectedGenre() === genre.value"
                (click)="onGenreChange(genre.value)">
                {{ genre.label }}
            </button>
            }
        </div>
    </div>

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-state">
        <div class="spinner"></div>
        <p>Cargando m√∫sica incre√≠ble...</p>
    </div>
    }

    <!-- Error State -->
    @if (error() && !loading()) {
    <div class="error-state">
        <span class="error-icon">‚ö†Ô∏è</span>
        <p>{{ error() }}</p>
        <button class="retry-btn" (click)="loadPopularTracks()">Reintentar</button>
    </div>
    }

    <!-- Songs Grid -->
    @if (!loading() && !error() && songs().length > 0) {
    <div class="songs-grid">
        @for (song of songs(); track song.id) {
        <div class="song-card" [class.playing]="isCurrentSong(song)">
            <!-- Album Cover -->
            <div class="album-cover" (click)="playSong(song)">
                <img [src]="song.img" [alt]="song.title" loading="lazy" />
                <div class="play-overlay">
                    @if (isCurrentSong(song) && isPlaying()) {
                    <span class="play-icon playing">‚è∏</span>
                    } @else {
                    <span class="play-icon">‚ñ∂Ô∏è</span>
                    }
                </div>
            </div>

            <!-- Song Info -->
            <div class="song-info">
                <h3 class="song-title" [title]="song.title">{{ song.title }}</h3>
                <p class="song-artist" [title]="song.artist">{{ song.artist }}</p>

                @if (song.album) {
                <p class="song-album" [title]="song.album">üìÄ {{ song.album }}</p>
                }

                @if (song.genre) {
                <p class="song-genre">üéµ {{ song.genre }}</p>
                }
            </div>

            <!-- Actions -->
            <div class="song-actions">
                <button class="action-btn favorite-btn" [class.is-favorite]="isFavorite(song.id)"
                    (click)="addToFavorites(song, $event)"
                    [title]="isFavorite(song.id) ? 'En favoritos' : 'Agregar a favoritos'">
                    @if (isFavorite(song.id)) {
                    <span>‚ù§Ô∏è</span>
                    } @else {
                    <span>ü§ç</span>
                    }
                </button>

                <span class="duration">{{ song.duration }}</span>
            </div>

            <!-- License Badge -->
            @if (song.license) {
            <a [href]="song.license" target="_blank" class="license-badge" title="Ver licencia Creative Commons">
                <span>CC</span>
            </a>
            }
        </div>
        }
    </div>
    }

    <!-- Empty State -->
    @if (!loading() && !error() && songs().length === 0) {
    <div class="empty-state">
        <span class="empty-icon">üéµ</span>
        <p>No se encontraron canciones</p>
        <button class="retry-btn" (click)="loadPopularTracks()">Ver populares</button>
    </div>
    }

    <!-- Info Footer -->
    <div class="info-footer">
        <p>
            <span class="icon">‚ÑπÔ∏è</span>
            Toda la m√∫sica est√° bajo licencia <strong>Creative Commons</strong> y es de uso libre.
            Powered by <a href="https://www.jamendo.com" target="_blank">Jamendo Music</a>
        </p>
    </div>
</div>