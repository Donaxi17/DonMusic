<div class="space-y-6 md:space-y-8 animate-fade-in pb-24">
    <header class="mb-6 md:mb-8">
        <div class="flex items-center gap-3 mb-2">
            <div
                class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center">
                <i class='bx bx-trending-up text-xl md:text-2xl text-white'></i>
            </div>
            <h2
                class="text-2xl md:text-4xl font-bold bg-gradient-to-r from-blue-400 to-indigo-500 bg-clip-text text-transparent">
                Rankings por País
            </h2>
        </div>
        <p class="text-zinc-400 mt-2 text-sm md:text-base">
            Lo más sonado en cada rincón del mundo. Top 20 actualizado.
            <span class="text-zinc-500 text-xs ml-1">(Previews de 30s)</span>
        </p>
    </header>

    <!-- Country Selector -->
    <div class="flex gap-2 md:gap-3 overflow-x-auto pb-3 scrollbar-hide">
        <button *ngFor="let country of countries" (click)="selectCountry(country.code)"
            [class.bg-blue-600]="selectedCountry === country.code" [class.text-white]="selectedCountry === country.code"
            [class.shadow-lg]="selectedCountry === country.code"
            [class.shadow-blue-500]="selectedCountry === country.code"
            [class.bg-zinc-800]="selectedCountry !== country.code"
            [class.text-zinc-300]="selectedCountry !== country.code"
            class="px-4 py-2.5 md:px-6 md:py-3 rounded-full font-bold transition-all hover:scale-105 flex items-center gap-2 min-w-max text-sm md:text-base border border-transparent hover:border-blue-500/30">
            <span class="text-xl md:text-2xl">{{country.flag}}</span>
            <span>{{country.name}}</span>
        </button>
    </div>

    <div class="flex flex-col lg:flex-row gap-6 md:gap-8">
        <!-- Chart List -->
        <div class="flex-1 space-y-3">
            <!-- Header con botón Play All -->
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg md:text-xl font-bold text-white">
                    Top 20 - {{selectedCountryName}}
                </h3>
                <button *ngIf="chartSongs().length > 0" (click)="playAll()"
                    class="px-4 py-2 md:px-6 md:py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-full transition-all flex items-center gap-2 hover:scale-105 shadow-lg shadow-blue-500 text-sm md:text-base">
                    <i class='bx bx-play-circle text-xl md:text-2xl'></i>
                    <span class="hidden sm:inline">Reproducir Todo</span>
                    <span class="sm:hidden">Play</span>
                </button>
            </div>

            <!-- Loading State -->
            <div *ngIf="loading()" class="flex justify-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
            </div>

            <!-- Songs List -->
            <div class="space-y-2">
                <ng-container *ngFor="let song of chartSongs(); let i = index">
                    <!-- Song Item -->
                    <div (click)="playSong(song)"
                        class="flex items-center gap-3 md:gap-4 p-3 md:p-4 rounded-xl bg-zinc-900/40 border border-zinc-800 hover:bg-zinc-800 hover:border-blue-500/50 transition-all group cursor-pointer">

                        <!-- Ranking Number -->
                        <div class="flex items-center justify-center w-8 md:w-10 flex-shrink-0">
                            <span class="text-lg md:text-xl font-bold" [class.text-yellow-400]="i === 0"
                                [class.text-zinc-400]="i === 1" [class.text-amber-600]="i === 2"
                                [class.text-zinc-600]="i > 2">
                                {{i + 1}}
                            </span>
                        </div>

                        <!-- Album Cover -->
                        <div
                            class="relative w-12 h-12 md:w-14 md:h-14 bg-zinc-800 rounded-lg flex-shrink-0 overflow-hidden shadow-md group-hover:scale-105 transition-transform">
                            <img [src]="song.img" [alt]="song.title" (error)="handleImageError($event, song.title)"
                                loading="lazy" class="w-full h-full object-cover">
                            <div
                                class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                <i class='bx bx-play-circle text-2xl md:text-3xl text-white'></i>
                            </div>
                        </div>

                        <!-- Song Info -->
                        <div class="flex-1 min-w-0">
                            <h4
                                class="font-bold truncate text-sm md:text-base text-white group-hover:text-blue-400 transition-colors">
                                {{song.title}}
                            </h4>
                            <p class="text-xs md:text-sm text-zinc-400 truncate">{{song.artist}}</p>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="text-xs px-2 py-0.5 bg-blue-500/20 text-blue-400 rounded-full">
                                    {{song.genre}}
                                </span>
                                <span class="text-xs text-zinc-500">{{song.duration}}</span>
                            </div>
                        </div>

                        <!-- Play Button -->
                        <button
                            class="w-10 h-10 md:w-12 md:h-12 rounded-full bg-blue-600 hover:bg-blue-500 flex items-center justify-center text-white transition-all hover:scale-110 opacity-0 group-hover:opacity-100 shadow-lg">
                            <i class='bx bx-play text-xl md:text-2xl'></i>
                        </button>
                    </div>

                    <!-- Ad Banner after 10th item (index 9) -->
                    <div *ngIf="i === 9" class="py-4">
                        <app-ad-banner adType="Banner Horizontal"></app-ad-banner>
                    </div>
                </ng-container>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="w-full lg:w-80 xl:w-96 flex-shrink-0">
            <div class="sticky top-24">
                <!-- Ad Banner -->
                <app-ad-banner adType="Anuncio Lateral" class="hidden md:block mb-6"></app-ad-banner>

                <!-- Featured Song Card -->
                <div *ngIf="chartSongs().length > 0"
                    class="bg-gradient-to-br from-zinc-900 to-zinc-800 rounded-2xl p-5 md:p-6 border border-zinc-700 shadow-xl">
                    <div class="flex items-center gap-2 mb-4">
                        <i class='bx bx-trophy text-2xl text-yellow-400'></i>
                        <h3 class="font-bold text-white text-base md:text-lg">
                            #1 en {{selectedCountryName}}
                        </h3>
                    </div>

                    <!-- Featured Image -->
                    <div class="aspect-square bg-zinc-800 rounded-xl mb-4 shadow-2xl overflow-hidden relative group cursor-pointer"
                        (click)="playSong(chartSongs()[0])">
                        <img [src]="chartSongs()[0].img" [alt]="chartSongs()[0].title"
                            (error)="handleImageError($event, chartSongs()[0].title)" loading="lazy"
                            class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                        <div
                            class="absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/50 transition-colors">
                            <i
                                class='bx bx-play-circle text-6xl md:text-7xl text-white opacity-90 group-hover:opacity-100 transition-all scale-90 group-hover:scale-100 duration-300 drop-shadow-2xl'></i>
                        </div>
                    </div>

                    <!-- Song Details -->
                    <div class="mb-4">
                        <h4 class="font-bold text-white text-base md:text-lg mb-1 truncate">
                            {{chartSongs()[0].title}}
                        </h4>
                        <p class="text-sm text-zinc-400 mb-2">{{chartSongs()[0].artist}}</p>
                        <div class="flex items-center gap-2">
                            <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded-full font-medium">
                                {{chartSongs()[0].genre}}
                            </span>
                            <span class="text-xs text-zinc-500">{{chartSongs()[0].duration}}</span>
                        </div>
                    </div>

                    <!-- Action Button -->
                    <button (click)="playSong(chartSongs()[0])"
                        class="w-full bg-blue-600 hover:bg-blue-500 text-white py-3 md:py-3.5 rounded-xl font-bold transition-all shadow-lg shadow-blue-900 text-sm md:text-base flex items-center justify-center gap-2 hover:scale-105">
                        <i class='bx bx-play-circle text-2xl'></i>
                        Escuchar Ahora
                    </button>
                </div>

                <!-- Info Card -->
                <div class="mt-6 p-4 bg-zinc-900/50 border border-zinc-800 rounded-xl">
                    <h4 class="font-bold text-white mb-2 flex items-center gap-2 text-sm">
                        <i class='bx bx-info-circle text-blue-400'></i>
                        Sobre los Rankings
                    </h4>
                    <p class="text-xs text-zinc-400 leading-relaxed mb-2">
                        Rankings actualizados basados en las canciones más escuchadas. Descubre lo que está sonando
                        ahora mismo.
                    </p>
                    <div class="flex items-start gap-2 pt-2 border-t border-zinc-800">
                        <i class='bx bx-time-five text-blue-400 mt-0.5'></i>
                        <p class="text-xs text-zinc-500 italic">
                            Las canciones son previews de 30 segundos cortesía de iTunes. Para canciones completas,
                            visita la sección "Sin Copyright".
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>