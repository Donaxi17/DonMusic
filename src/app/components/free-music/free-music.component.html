<div class="min-h-screen bg-zinc-950 pb-24 animate-fade-in">
    <div class="max-w-7xl mx-auto px-4 md:px-6 py-8">

        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-3">
                <div
                    class="w-12 h-12 rounded-full bg-gradient-to-r from-emerald-500 to-green-500 flex items-center justify-center">
                    <i class='bx bx-shield-alt-2 text-2xl text-white'></i>
                </div>
                <div>
                    <h1 class="text-3xl md:text-5xl font-bold text-white">Música Sin Copyright</h1>
                    <p class="text-zinc-400 mt-1">Legal • Streaming completo • Descargas gratis • 100% libre</p>
                </div>
            </div>
            <div class="bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4 flex items-start gap-3">
                <i class='bx bx-info-circle text-2xl text-emerald-400 flex-shrink-0'></i>
                <div class="text-sm text-zinc-300">
                    <strong class="text-emerald-400">Música 100% legal y sin copyright</strong> - Pop, rock,
                    electrónica, hip hop y más géneros. Todas las canciones son de artistas independientes y pueden ser
                    escuchadas y descargadas libremente. Powered by Jamendo.
                </div>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="mb-6">
            <div class="relative group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i
                        class='bx bx-search text-zinc-400 text-xl group-focus-within:text-emerald-500 transition-colors'></i>
                </div>
                <input type="text" [(ngModel)]="searchQuery" (keyup.enter)="searchMusic()"
                    class="block w-full pl-12 pr-4 py-3 border border-zinc-700 rounded-full bg-zinc-900 text-zinc-300 placeholder-zinc-500 focus:outline-none focus:bg-black focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 transition-all"
                    placeholder="Buscar música sin copyright...">
                <button *ngIf="searchQuery()" (click)="searchMusic()"
                    class="absolute inset-y-1 right-1 px-6 bg-emerald-600 hover:bg-emerald-500 text-white rounded-full font-bold transition-colors">
                    Buscar
                </button>
            </div>
        </div>

        <!-- Genre Filters -->
        <div class="mb-8">
            <h3 class="text-lg font-bold text-white mb-4">Géneros Populares</h3>
            <div class="flex flex-wrap gap-2">
                <button *ngFor="let genre of latinGenres" (click)="loadMusicByGenre(genre.id)"
                    [class.bg-emerald-600]="selectedGenre() === genre.id"
                    [class.text-white]="selectedGenre() === genre.id" [class.bg-zinc-800]="selectedGenre() !== genre.id"
                    [class.text-zinc-300]="selectedGenre() !== genre.id"
                    class="px-4 py-2 rounded-full font-medium hover:bg-emerald-500 hover:text-white transition-all flex items-center gap-2">
                    <span>{{genre.icon}}</span>
                    <span>{{genre.name}}</span>
                </button>
            </div>
        </div>

        <!-- Ad Banner -->
        <!-- <app-ad-banner adType="Banner Música Gratis" class="mb-8 block"></app-ad-banner> -->

        <!-- Loading State -->
        <div *ngIf="isLoading()" class="flex justify-center py-12">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-emerald-500"></div>
        </div>

        <!-- Songs List -->
        <div *ngIf="!isLoading() && songs().length > 0">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-white">
                    {{songs().length}} canciones encontradas
                </h3>
                <button (click)="playAll()"
                    class="px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-full transition-all flex items-center gap-2 hover:scale-105">
                    <i class='bx bx-play-circle text-2xl'></i>
                    Reproducir Todo
                </button>
            </div>

            <div class="grid gap-3">
                <div *ngFor="let song of songs()"
                    class="flex items-center gap-4 p-4 rounded-xl bg-zinc-900/40 border border-zinc-800 hover:bg-zinc-800 hover:border-emerald-500/50 transition-all group cursor-pointer"
                    (click)="playSong(song)">

                    <!-- Album Cover con fallback -->
                    <div
                        class="relative w-16 h-16 rounded-lg overflow-hidden bg-zinc-800 flex-shrink-0 group-hover:scale-105 transition-transform">
                        <img [src]="song.img" [alt]="song.title"
                            (error)="handleImageError($event, song.title)"
                            class="w-full h-full object-cover">
                        <div
                            class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                            <i class='bx bx-play-circle text-3xl text-white'></i>
                        </div>
                    </div>

                    <!-- Song Info -->
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-white truncate group-hover:text-emerald-400 transition-colors">
                            {{song.title}}
                        </h4>
                        <p class="text-sm text-zinc-400 truncate">{{song.artist}}</p>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-xs px-2 py-0.5 bg-emerald-500/20 text-emerald-400 rounded-full">
                                {{song.genre}}
                            </span>
                            <span class="text-xs text-zinc-500">{{song.duration}}</span>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex items-center gap-2">
                        <!-- Download Button -->
                        <button (click)="openDownloadModal(song); $event.stopPropagation()"
                            class="w-10 h-10 rounded-full bg-zinc-800 hover:bg-zinc-700 flex items-center justify-center text-emerald-400 hover:text-emerald-300 transition-all hover:scale-110"
                            title="Descargar">
                            <i class='bx bx-download text-xl'></i>
                        </button>

                        <!-- Play Button -->
                        <button (click)="playSong(song); $event.stopPropagation()"
                            class="w-12 h-12 rounded-full bg-emerald-600 hover:bg-emerald-500 flex items-center justify-center text-white transition-all hover:scale-110 opacity-0 group-hover:opacity-100">
                            <i class='bx bx-play text-2xl'></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading() && songs().length === 0" class="text-center py-16">
            <div class="w-20 h-20 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class='bx bx-music text-4xl text-zinc-600'></i>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">No se encontraron canciones</h3>
            <p class="text-zinc-500 mb-6">Intenta con otro género o término de búsqueda</p>
        </div>

        <!-- Info Footer -->
        <div class="mt-12 p-6 bg-zinc-900/50 border border-zinc-800 rounded-xl">
            <h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                <i class='bx bx-shield-alt-2 text-emerald-400'></i>
                Música 100% Legal y Sin Copyright
            </h4>
            <ul class="space-y-2 text-sm text-zinc-400">
                <li class="flex items-start gap-2">
                    <i class='bx bx-check text-emerald-400 flex-shrink-0 mt-0.5'></i>
                    <span>Música moderna (2020-2024)</span>
                </li>
                <li class="flex items-start gap-2">
                    <i class='bx bx-check text-emerald-400 flex-shrink-0 mt-0.5'></i>
                    <span>Descarga gratis y sin restricciones</span>
                </li>
                <li class="flex items-start gap-2">
                    <i class='bx bx-check text-emerald-400 flex-shrink-0 mt-0.5'></i>
                    <span>Streaming completo de alta calidad (no solo previews de 30 segundos)</span>
                </li>
                <li class="flex items-start gap-2">
                    <i class='bx bx-check text-emerald-400 flex-shrink-0 mt-0.5'></i>
                    <span>100% legal - Sin problemas de copyright</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- Download Modal con Anuncios - OPTIMIZADO -->
    <div *ngIf="showDownloadModal()"
        class="fixed inset-0 z-50 flex items-start justify-center p-0 md:p-4 md:pt-8 bg-black/90 backdrop-blur-sm animate-fade-in overflow-y-auto"
        style="will-change: opacity, transform;">
        <div class="bg-zinc-900 border-t md:border border-zinc-700 rounded-t-2xl md:rounded-2xl w-full md:max-w-lg flex flex-col shadow-2xl relative my-auto md:my-0"
            style="will-change: transform;">

            <!-- Header -->
            <div
                class="bg-gradient-to-r from-emerald-600 to-green-600 p-4 md:p-6 flex items-center justify-between flex-shrink-0">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                    <i class='bx bx-download text-2xl md:text-3xl text-white'></i>
                    <div class="min-w-0 flex-1">
                        <h3 class="text-base md:text-xl font-bold text-white truncate">Descargar Canción</h3>
                        <p class="text-xs md:text-sm text-emerald-100 truncate">
                            {{selectedDownloadSong()?.title}} - {{selectedDownloadSong()?.artist}}
                        </p>
                    </div>
                </div>
                <button (click)="closeDownloadModal()"
                    class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-black/20 hover:bg-black/40 flex items-center justify-center text-white transition-colors flex-shrink-0">
                    <i class='bx bx-x text-2xl md:text-3xl'></i>
                </button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-4 md:p-6">
                <!-- Ad Banner -->
                <!-- <app-ad-banner adType="Banner Descarga" class="block w-full mb-6"></app-ad-banner> -->

                <!-- Countdown or Download Button -->
                <div class="text-center">
                    <div *ngIf="!canDownload()" class="mb-6">
                        <div
                            class="w-20 h-20 mx-auto mb-4 rounded-full bg-emerald-500/20 flex items-center justify-center">
                            <span class="text-4xl font-bold text-emerald-400">{{downloadCountdown()}}</span>
                        </div>
                        <p class="text-zinc-400 text-sm">Espera {{downloadCountdown()}} segundos para descargar...</p>
                        <p class="text-zinc-500 text-xs mt-2">Los anuncios nos ayudan a mantener el servicio gratis</p>
                    </div>

                    <button *ngIf="canDownload()" (click)="downloadSong()"
                        class="w-full px-8 py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl transition-all flex items-center justify-center gap-3 hover:scale-105 shadow-lg shadow-emerald-500/20">
                        <i class='bx bx-download text-2xl'></i>
                        <span>Descargar Ahora</span>
                    </button>
                </div>

                <!-- Info -->
                <div class="mt-6 p-4 bg-zinc-800/50 rounded-xl border border-zinc-700">
                    <h4 class="font-bold text-white mb-2 flex items-center gap-2">
                        <i class='bx bx-info-circle text-emerald-400'></i>
                        Información de Descarga
                    </h4>
                    <ul class="space-y-2 text-sm text-zinc-400">
                        <li class="flex items-start gap-2">
                            <i class='bx bx-check text-emerald-400 flex-shrink-0 mt-0.5'></i>
                            <span>Formato: MP3 de alta calidad</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class='bx bx-check text-emerald-400 flex-shrink-0 mt-0.5'></i>
                            <span>Licencia: Creative Commons - Uso libre</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class='bx bx-check text-emerald-400 flex-shrink-0 mt-0.5'></i>
                            <span>Sin DRM - Usa la música como quieras</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
